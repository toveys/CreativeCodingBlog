---
title: Eighth Post
publish_date: 2023-05-25
disable_html_sanitization: true
---

# Creating the background

I started creating the background visuals, which I also wanted to be reactive to music. While I had watched a video from Frank's Laboratory already to figure out how to make my main audio visualiser, that video was meant as a crash course. So I watched a more in-depth video from Frank's Laboratory where they connected a microphone to their code and used the waveforms from the mic to make some interesting animations.

<iframe width="640" height="385" src="https://www.youtube.com/embed/qNEb9of714U" title="Animate Voice &amp; Music with JavaScript" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

This video was meant for the use of a microphone, but I was not going to be using one for this project. This video was still very helpful. I don't know very much about audio and dealing with it in this project was quite challenging for me. I noticed that the wave for Frank's microphone had all sorts of frequencies and was very "hilly". In contrast, the mp3 file waves weren't as hilly and was more of a ramp shape. Due to this when I made the background of my audio visualiser a circle of animated bars it moved alot more on one side of the screen than on the others. This was not what I wanted, I had hoped for the movement to be alot more equal all over the screen. I had to add alot more canvas rotation to fix this problem, so now the average movement was the same all over the screen, however alot of the animated bars just didn't seem to be moving at all. I guess the mp3s that I was feeding in didn't have the frequencies necessary to move these bars. I added some overall canvas rotation, a small value so the background moved slowly and wasn't too distracting which also helped lessen the processing power needed to run the animation. I managed to make the background resemble lights you could see at a light show. Sweeping spotlights making circular patterns, complementing the main circular visualiser. I also made the colors of the background blues and purples for a cool look, and I also added some of the CSS filters I was experimenting with in the last iteration. The background is subtly blurred so that it appears distant, and with the slow movement it creates some illusion of distance. The background also encircles the main audio visualiser which creates a sort of border that I made sure the main visualiser did not cross by controlling the length of the bars.

![Background](../imagesFinal/second%20iteration%20with%20background%20with%20effects.jpg)

I also added some more functionality to my project by adding some CSS and Javascript to deal with the media controls. I needed to make sure that the recursive animation functions that were playing while music played were able to stop when I pressed the pause button as well as stop when the music ends. This was very annoying to deal with as I had and still have some minor issues where animations didn't end or kept redrawing when I pressed the play button or tried to change the mp3 files. Some animations overlapped without clearing the canvas, but I wouldn't be able to see this, I just had to speculate as my computer started slowing down. I also had problems with the audio increasing every time I paused and then resumed a song. For some reason the audio was stacking on top of each other even though I was sure that it was only playing one audio file at a time. I put in some code that would delete the AudioContext after changing the input audio file which seemed to work. I only found one discussion on Stack Overflow where someone seemed to be having a similar issue and they recommended deleting the AudioContext after every play because it might have been using resources from the previous file. I originally drew the background and the circle visualiser on one canvas but then I ended up splitting them into a foreground and background canvas since I couldn't stop my background from drawing over the main audio visualiser even though it was created before the main visualiser in the code.